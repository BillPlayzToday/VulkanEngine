<!DOCTYPE html>
<!--[if lt IE 7]>       <html class="no-js ie6 oldie" lang="en"> <![endif]-->
<!--[if IE 7]>          <html class="no-js ie7 oldie" lang="en"> <![endif]-->
<!--[if IE 8]>          <html class="no-js ie8 oldie" lang="en"> <![endif]-->
<!--[if gt IE 8]><!-->
<html class="no-js" lang="en"><!--<![endif]--><head>
<meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <title>Physical devices and queue families - Vulkan Tutorial</title>
    <meta name="description" content="A tutorial that teaches you everything it takes to render 3D graphics with the Vulkan API. It covers everything from Windows/Linux setup to rendering and debugging.">
    <meta name="author" content="Alexander Overvoorde">
    <meta charset="UTF-8">
    <link rel="icon" href="https://vulkan-tutorial.com/images/favicon.png" type="image/png">
    <!-- Mobile -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Font -->
    <link href="Physical%20devices%20and%20queue%20families%20-%20Vulkan%20Tutorial_files/css.css" rel="stylesheet" type="text/css">
    <!-- CSS -->
    <link href="Physical%20devices%20and%20queue%20families%20-%20Vulkan%20Tutorial_files/theme.min.css" rel="stylesheet" type="text/css"><link href="Physical%20devices%20and%20queue%20families%20-%20Vulkan%20Tutorial_files/theme-blue.min.css" rel="stylesheet" type="text/css">
    
    <!--[if lt IE 9]>
    <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <!-- Matomo -->
    <script type="text/javascript" async="" defer="defer" src="Physical%20devices%20and%20queue%20families%20-%20Vulkan%20Tutorial_files/piwik.js"></script><script type="text/javascript">
      var _paq = _paq || [];
      /* tracker methods like "setCustomDimension" should be called before "trackPageView" */
      _paq.push(["setDocumentTitle", document.domain + "/" + document.title]);
      _paq.push(["setCookieDomain", "*.vulkan-tutorial.com"]);
      _paq.push(["setDomains", ["*.vulkan-tutorial.com"]]);
      _paq.push(['trackPageView']);
      _paq.push(['enableLinkTracking']);
      (function() {
        var u="//matomo.while.io/";
        _paq.push(['setTrackerUrl', u+'piwik.php']);
        _paq.push(['setSiteId', '2']);
        var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
        g.type='text/javascript'; g.async=true; g.defer=true; g.src=u+'piwik.js'; s.parentNode.insertBefore(g,s);
      })();
    </script>
    <!-- End Matomo Code -->

    <script type="text/javascript" src="Physical%20devices%20and%20queue%20families%20-%20Vulkan%20Tutorial_files/4309.js"></script>
<script src="Physical%20devices%20and%20queue%20families%20-%20Vulkan%20Tutorial_files/embed.js" data-timestamp="1656794117451"></script><link rel="prefetch" as="style" href="Physical%20devices%20and%20queue%20families%20-%20Vulkan%20Tutorial_files/a_data_004/lounge.63860eb743c7d9d2adf0fa435788abe7.css"><link rel="prefetch" as="script" href="Physical%20devices%20and%20queue%20families%20-%20Vulkan%20Tutorial_files/a_data_004/common.bundle.33bc87b2c4f9324203cc85b7dd1d0492.js"><link rel="prefetch" as="script" href="Physical%20devices%20and%20queue%20families%20-%20Vulkan%20Tutorial_files/a_data_004/lounge.bundle.39ef974e33e97bdc315c595632f05d3c.js"><link rel="prefetch" as="script" href="Physical%20devices%20and%20queue%20families%20-%20Vulkan%20Tutorial_files/a_data_004/config.js"><script async="" id="dsq_recs_scr" src="Physical%20devices%20and%20queue%20families%20-%20Vulkan%20Tutorial_files/recommendations.js"></script><link rel="prefetch" as="style" href="Physical%20devices%20and%20queue%20families%20-%20Vulkan%20Tutorial_files/a_data_003/recommendations.10022a97346f1c6e3798931bbd8e4bb5.css"><link rel="prefetch" as="script" href="Physical%20devices%20and%20queue%20families%20-%20Vulkan%20Tutorial_files/a_data_003/common.bundle.a59fbd11efae764ccd959d61e4925fee.js"><link rel="prefetch" as="script" href="Physical%20devices%20and%20queue%20families%20-%20Vulkan%20Tutorial_files/a_data_003/recommendations.bundle.926bc472e4859a48daa346b4ba2ab4f4.js"><link rel="prefetch" as="script" href="Physical%20devices%20and%20queue%20families%20-%20Vulkan%20Tutorial_files/a_data_004/config.js"></head>
<body class="">
    
<div class="container-fluid fluid-height wrapper">
    <div class="row columns content">
        <div class="left-column article-tree col-sm-3 hidden-print">
            <!-- For Mobile -->
            <div class="responsive-collapse">
                <button type="button" class="btn btn-sidebar" id="menu-spinner-button">
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
            </div>
            <div id="sub-nav-collapse" class="sub-nav-collapse">
                <div class="nav-logo">
                    Vulkan Tutorial
                </div>

                <!-- Language picker -->
                <div class="language-picker">
                <a href="https://vulkan-tutorial.com/Introduction">English</a> / <a href="https://vulkan-tutorial.com/fr/Introduction">Français</a>                </div>

                <!-- Navigation -->
                <div style="padding-top: 20px; padding-bottom: 20px; background: #272525">
                <ul class="Nav"><li class="Nav__item "><a href="https://vulkan-tutorial.com/Introduction">Introduction</a></li><li class="Nav__item "><a href="https://vulkan-tutorial.com/Overview">Overview</a></li><li class="Nav__item "><a href="https://vulkan-tutorial.com/Development_environment">Development environment</a></li><li class="Nav__item Nav__item--open has-children"><a href="https://vulkan-tutorial.com/Drawing_a_triangle/Setup/Base_code" class="folder"><i class="Nav__arrow">&nbsp;</i>Drawing a triangle</a><ul class="Nav"><li class="Nav__item Nav__item--open has-children"><a href="https://vulkan-tutorial.com/Drawing_a_triangle/Setup/Base_code" class="folder"><i class="Nav__arrow">&nbsp;</i>Setup</a><ul class="Nav"><li class="Nav__item "><a href="https://vulkan-tutorial.com/Drawing_a_triangle/Setup/Base_code">Base code</a></li><li class="Nav__item "><a href="https://vulkan-tutorial.com/Drawing_a_triangle/Setup/Instance">Instance</a></li><li class="Nav__item "><a href="https://vulkan-tutorial.com/Drawing_a_triangle/Setup/Validation_layers">Validation layers</a></li><li class="Nav__item Nav__item--active"><a href="https://vulkan-tutorial.com/Drawing_a_triangle/Setup/Physical_devices_and_queue_families">Physical devices and queue families</a></li><li class="Nav__item "><a href="https://vulkan-tutorial.com/Drawing_a_triangle/Setup/Logical_device_and_queues">Logical device and queues</a></li></ul></li><li class="Nav__item  has-children"><a href="https://vulkan-tutorial.com/Drawing_a_triangle/Presentation/Window_surface" class="folder"><i class="Nav__arrow">&nbsp;</i>Presentation</a><ul class="Nav"><li class="Nav__item "><a href="https://vulkan-tutorial.com/Drawing_a_triangle/Presentation/Window_surface">Window surface</a></li><li class="Nav__item "><a href="https://vulkan-tutorial.com/Drawing_a_triangle/Presentation/Swap_chain">Swap chain</a></li><li class="Nav__item "><a href="https://vulkan-tutorial.com/Drawing_a_triangle/Presentation/Image_views">Image views</a></li></ul></li><li class="Nav__item  has-children"><a href="https://vulkan-tutorial.com/Drawing_a_triangle/Graphics_pipeline_basics/Introduction" class="folder"><i class="Nav__arrow">&nbsp;</i>Graphics pipeline basics</a><ul class="Nav"><li class="Nav__item "><a href="https://vulkan-tutorial.com/Drawing_a_triangle/Graphics_pipeline_basics/Introduction">Introduction</a></li><li class="Nav__item "><a href="https://vulkan-tutorial.com/Drawing_a_triangle/Graphics_pipeline_basics/Shader_modules">Shader modules</a></li><li class="Nav__item "><a href="https://vulkan-tutorial.com/Drawing_a_triangle/Graphics_pipeline_basics/Fixed_functions">Fixed functions</a></li><li class="Nav__item "><a href="https://vulkan-tutorial.com/Drawing_a_triangle/Graphics_pipeline_basics/Render_passes">Render passes</a></li><li class="Nav__item "><a href="https://vulkan-tutorial.com/Drawing_a_triangle/Graphics_pipeline_basics/Conclusion">Conclusion</a></li></ul></li><li class="Nav__item  has-children"><a href="https://vulkan-tutorial.com/Drawing_a_triangle/Drawing/Framebuffers" class="folder"><i class="Nav__arrow">&nbsp;</i>Drawing</a><ul class="Nav"><li class="Nav__item "><a href="https://vulkan-tutorial.com/Drawing_a_triangle/Drawing/Framebuffers">Framebuffers</a></li><li class="Nav__item "><a href="https://vulkan-tutorial.com/Drawing_a_triangle/Drawing/Command_buffers">Command buffers</a></li><li class="Nav__item "><a href="https://vulkan-tutorial.com/Drawing_a_triangle/Drawing/Rendering_and_presentation">Rendering and presentation</a></li><li class="Nav__item "><a href="https://vulkan-tutorial.com/Drawing_a_triangle/Drawing/Frames_in_flight">Frames in flight</a></li></ul></li><li class="Nav__item "><a href="https://vulkan-tutorial.com/Drawing_a_triangle/Swap_chain_recreation">Swap chain recreation</a></li></ul></li><li class="Nav__item  has-children"><a href="https://vulkan-tutorial.com/Vertex_buffers/Vertex_input_description" class="folder"><i class="Nav__arrow">&nbsp;</i>Vertex buffers</a><ul class="Nav"><li class="Nav__item "><a href="https://vulkan-tutorial.com/Vertex_buffers/Vertex_input_description">Vertex input description</a></li><li class="Nav__item "><a href="https://vulkan-tutorial.com/Vertex_buffers/Vertex_buffer_creation">Vertex buffer creation</a></li><li class="Nav__item "><a href="https://vulkan-tutorial.com/Vertex_buffers/Staging_buffer">Staging buffer</a></li><li class="Nav__item "><a href="https://vulkan-tutorial.com/Vertex_buffers/Index_buffer">Index buffer</a></li></ul></li><li class="Nav__item  has-children"><a href="https://vulkan-tutorial.com/Uniform_buffers/Descriptor_layout_and_buffer" class="folder"><i class="Nav__arrow">&nbsp;</i>Uniform buffers</a><ul class="Nav"><li class="Nav__item "><a href="https://vulkan-tutorial.com/Uniform_buffers/Descriptor_layout_and_buffer">Descriptor layout and buffer</a></li><li class="Nav__item "><a href="https://vulkan-tutorial.com/Uniform_buffers/Descriptor_pool_and_sets">Descriptor pool and sets</a></li></ul></li><li class="Nav__item  has-children"><a href="https://vulkan-tutorial.com/Texture_mapping/Images" class="folder"><i class="Nav__arrow">&nbsp;</i>Texture mapping</a><ul class="Nav"><li class="Nav__item "><a href="https://vulkan-tutorial.com/Texture_mapping/Images">Images</a></li><li class="Nav__item "><a href="https://vulkan-tutorial.com/Texture_mapping/Image_view_and_sampler">Image view and sampler</a></li><li class="Nav__item "><a href="https://vulkan-tutorial.com/Texture_mapping/Combined_image_sampler">Combined image sampler</a></li></ul></li><li class="Nav__item "><a href="https://vulkan-tutorial.com/Depth_buffering">Depth buffering</a></li><li class="Nav__item "><a href="https://vulkan-tutorial.com/Loading_models">Loading models</a></li><li class="Nav__item "><a href="https://vulkan-tutorial.com/Generating_Mipmaps">Generating Mipmaps</a></li><li class="Nav__item "><a href="https://vulkan-tutorial.com/Multisampling">Multisampling</a></li><li class="Nav__item "><a href="https://vulkan-tutorial.com/FAQ">FAQ</a></li><li class="Nav__item "><a href="https://vulkan-tutorial.com/Privacy_policy">Privacy policy</a></li></ul>                </div>

                <div class="sidebar-links">
                    
                        <!-- Links -->
                        <a href="https://github.com/Overv/VulkanTutorial" target="_blank">GitHub Repository</a><br><a href="https://www.paypal.me/AOvervoorde" target="_blank">Support the website</a><br><br><a href="https://www.khronos.org/registry/vulkan/specs/1.3-extensions/html/" target="_blank">Vulkan Specification</a><br><a href="https://lunarg.com/vulkan-sdk/" target="_blank">LunarG Vulkan SDK</a><br><a href="https://github.com/KhronosGroup/Vulkan-Guide" target="_blank">Vulkan Guide</a><br><a href="https://vulkan.gpuinfo.org/" target="_blank">Vulkan Hardware Database</a><br><br><a href="https://github.com/bwasty/vulkan-tutorial-rs" target="_blank">Tutorial for Rust</a><br><a href="https://github.com/Naitsirc98/Vulkan-Tutorial-Java" target="_blank">Tutorial for Java</a><br><a href="https://github.com/jjYBdx4IL/VulkanTutorial-VisualStudioProjectFiles" target="_blank">Visual Studio 2019 samples</a><br>
                        <div id="toggleCodeBlock">
                                                </div>

                        <!-- Twitter -->
                                                            </div>

                <div style="color: #666; padding: 0 20px 0 20px; font-size: 90%">
                    This site is not affiliated with or endorsed by the 
Khronos Group. Vulkan® and the Vulkan logo are trademarks of the Khronos
 Group Inc.
                </div>
            </div>
        </div>
        <div class="right-column  content-area col-sm-9">
            <div class="content-page" style="position: relative;">
                <div class="adbox-side" style="position: absolute; left: calc(100% + 50px);">
                    <div id="waldo-tag-4310"></div>
                </div>

                <div class="adbox-side" style="position: absolute; left: -350px">
                    <div id="waldo-tag-4312"></div>
                </div>

                
                <div class="doc_content">
                    <article>
            <div class="page-header">
            <h1>Physical devices and queue families</h1>
        </div>
    
    <ul class="TableOfContents">
<li>
<p><a href="#page_Selecting-a-physical-device">Selecting a physical device</a></p>
</li>
<li>
<p><a href="#page_Base-device-suitability-checks">Base device suitability checks</a></p>
</li>
<li>
<p><a href="#page_Queue-families">Queue families</a></p>
</li>
</ul>
<h2 id="page_Selecting-a-physical-device">Selecting a physical device</h2>
<p>After initializing the Vulkan library through a <a href="https://www.khronos.org/registry/vulkan/specs/1.0/man/html/VkInstance.html"><code>VkInstance</code></a> we need to look for
and select a graphics card in the system that supports the features we need. In
fact we can select any number of graphics cards and use them simultaneously, but
in this tutorial we'll stick to the first graphics card that suits our needs.</p>
<p>We'll add a function <code>pickPhysicalDevice</code> and add a call to it in the
<code>initVulkan</code> function.</p>
<pre><code class="language-c++ hljs cpp"><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">initVulkan</span><span class="hljs-params">()</span> </span>{
    createInstance();
    setupDebugMessenger();
    pickPhysicalDevice();
}

<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">pickPhysicalDevice</span><span class="hljs-params">()</span> </span>{

}
</code></pre>
<p>The graphics card that we'll end up selecting will be stored in a
<a href="https://www.khronos.org/registry/vulkan/specs/1.0/man/html/VkPhysicalDevice.html"><code>VkPhysicalDevice</code></a> handle that is added as a new class member. This object will be
implicitly destroyed when the <a href="https://www.khronos.org/registry/vulkan/specs/1.0/man/html/VkInstance.html"><code>VkInstance</code></a> is destroyed, so we won't need to do
anything new in the <code>cleanup</code> function.</p>
<pre><code class="language-c++ hljs cpp"><span class="hljs-type">VkPhysicalDevice</span> physicalDevice = <span class="hljs-literal">VK_NULL_HANDLE</span>;
</code></pre>
<p>Listing the graphics cards is very similar to listing extensions and starts with
querying just the number.</p>
<pre><code class="language-c++ hljs cpp"><span class="hljs-keyword">uint32_t</span> deviceCount = <span class="hljs-number">0</span>;
<span class="hljs-function">vkEnumeratePhysicalDevices</span>(instance, &amp;deviceCount, <span class="hljs-literal">nullptr</span>);
</code></pre>
<p>If there are 0 devices with Vulkan support then there is no point going further.</p>
<pre><code class="language-c++ hljs cpp"><span class="hljs-keyword">if</span> (deviceCount == <span class="hljs-number">0</span>) {
    <span class="hljs-keyword">throw</span> <span class="hljs-built_in">std</span>::runtime_error(<span class="hljs-string">"failed to find GPUs with Vulkan support!"</span>);
}
</code></pre>
<p>Otherwise we can now allocate an array to hold all of the <a href="https://www.khronos.org/registry/vulkan/specs/1.0/man/html/VkPhysicalDevice.html"><code>VkPhysicalDevice</code></a>
handles.</p>
<pre><code class="language-c++ hljs cpp"><span class="hljs-built_in">std</span>::<span class="hljs-built_in">vector</span>&lt;VkPhysicalDevice&gt; devices(deviceCount);
<span class="hljs-function">vkEnumeratePhysicalDevices</span>(instance, &amp;deviceCount, devices.data());
</code></pre>
<p>Now we need to evaluate each of them and check if they are suitable for the
operations we want to perform, because not all graphics cards are created equal.
For that we'll introduce a new function:</p>
<pre><code class="language-c++ hljs cpp"><span class="hljs-function"><span class="hljs-keyword">bool</span> <span class="hljs-title">isDeviceSuitable</span><span class="hljs-params">(VkPhysicalDevice device)</span> </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
}
</code></pre>
<p>And we'll check if any of the physical devices meet the requirements that we'll
add to that function.</p>
<pre><code class="language-c++ hljs cpp"><span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> <span class="hljs-keyword">auto</span>&amp; device : devices) {
    <span class="hljs-keyword">if</span> (isDeviceSuitable(device)) {
        physicalDevice = device;
        <span class="hljs-keyword">break</span>;
    }
}

<span class="hljs-keyword">if</span> (physicalDevice == <span class="hljs-literal">VK_NULL_HANDLE</span>) {
    <span class="hljs-keyword">throw</span> <span class="hljs-built_in">std</span>::runtime_error(<span class="hljs-string">"failed to find a suitable GPU!"</span>);
}
</code></pre>
<p>The next section will introduce the first requirements that we'll check for in
the <code>isDeviceSuitable</code> function. As we'll start using more Vulkan features in
the later chapters we will also extend this function to include more checks.</p>
<h2 id="page_Base-device-suitability-checks">Base device suitability checks</h2>
<p>To evaluate the suitability of a device we can start by querying for some
details. Basic device properties like the name, type and supported Vulkan
version can be queried using <a href="https://www.khronos.org/registry/vulkan/specs/1.0/man/html/vkGetPhysicalDeviceProperties.html"><code>vkGetPhysicalDeviceProperties</code></a>.</p>
<pre><code class="language-c++ hljs cpp"><span class="hljs-type">VkPhysicalDeviceProperties</span> deviceProperties;
<span class="hljs-function">vkGetPhysicalDeviceProperties</span>(device, &amp;deviceProperties);
</code></pre>
<p>The support for optional features like texture compression, 64 bit floats and
multi viewport rendering (useful for VR) can be queried using
<a href="https://www.khronos.org/registry/vulkan/specs/1.0/man/html/vkGetPhysicalDeviceFeatures.html"><code>vkGetPhysicalDeviceFeatures</code></a>:</p>
<pre><code class="language-c++ hljs cpp"><span class="hljs-type">VkPhysicalDeviceFeatures</span> deviceFeatures;
<span class="hljs-function">vkGetPhysicalDeviceFeatures</span>(device, &amp;deviceFeatures);
</code></pre>
<p>There are more details that can be queried from devices that we'll discuss later
concerning device memory and queue families (see the next section).</p>
<p>As an example, let's say we consider our application only usable for dedicated
graphics cards that support geometry shaders. Then the <code>isDeviceSuitable</code>
function would look like this:</p>
<pre><code class="language-c++ hljs cpp"><span class="hljs-function"><span class="hljs-keyword">bool</span> <span class="hljs-title">isDeviceSuitable</span><span class="hljs-params">(VkPhysicalDevice device)</span> </span>{
    <span class="hljs-type">VkPhysicalDeviceProperties</span> deviceProperties;
    <span class="hljs-type">VkPhysicalDeviceFeatures</span> deviceFeatures;
    <span class="hljs-function">vkGetPhysicalDeviceProperties</span>(device, &amp;deviceProperties);
    <span class="hljs-function">vkGetPhysicalDeviceFeatures</span>(device, &amp;deviceFeatures);

    <span class="hljs-keyword">return</span> deviceProperties.deviceType == <span class="hljs-literal">VK_PHYSICAL_DEVICE_TYPE_DISCRETE_GPU</span> &amp;&amp;
           deviceFeatures.geometryShader;
}
</code></pre>
<p>Instead of just checking if a device is suitable or not and going with the first
one, you could also give each device a score and pick the highest one. That way
you could favor a dedicated graphics card by giving it a higher score, but fall
back to an integrated GPU if that's the only available one. You could implement
something like that as follows:</p>
<pre><code class="language-c++ hljs cpp"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;map&gt;</span></span>

...

<span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">pickPhysicalDevice</span><span class="hljs-params">()</span> </span>{
    ...

    <span class="hljs-comment">// Use an ordered map to automatically sort candidates by increasing score</span>
    <span class="hljs-built_in">std</span>::<span class="hljs-built_in">multimap</span>&lt;<span class="hljs-keyword">int</span>, VkPhysicalDevice&gt; candidates;

    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> <span class="hljs-keyword">auto</span>&amp; device : devices) {
        <span class="hljs-keyword">int</span> score = rateDeviceSuitability(device);
        candidates.insert(<span class="hljs-built_in">std</span>::make_pair(score, device));
    }

    <span class="hljs-comment">// Check if the best candidate is suitable at all</span>
    <span class="hljs-keyword">if</span> (candidates.rbegin()-&gt;first &gt; <span class="hljs-number">0</span>) {
        physicalDevice = candidates.rbegin()-&gt;second;
    } <span class="hljs-keyword">else</span> {
        <span class="hljs-keyword">throw</span> <span class="hljs-built_in">std</span>::runtime_error(<span class="hljs-string">"failed to find a suitable GPU!"</span>);
    }
}

<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">rateDeviceSuitability</span><span class="hljs-params">(VkPhysicalDevice device)</span> </span>{
    ...

    <span class="hljs-keyword">int</span> score = <span class="hljs-number">0</span>;

    <span class="hljs-comment">// Discrete GPUs have a significant performance advantage</span>
    <span class="hljs-keyword">if</span> (deviceProperties.deviceType == <span class="hljs-literal">VK_PHYSICAL_DEVICE_TYPE_DISCRETE_GPU</span>) {
        score += <span class="hljs-number">1000</span>;
    }

    <span class="hljs-comment">// Maximum possible size of textures affects graphics quality</span>
    score += deviceProperties.limits.maxImageDimension2D;

    <span class="hljs-comment">// Application can't function without geometry shaders</span>
    <span class="hljs-keyword">if</span> (!deviceFeatures.geometryShader) {
        <span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;
    }

    <span class="hljs-keyword">return</span> score;
}
</code></pre>
<p>You don't need to implement all that for this tutorial, but it's to give you an
idea of how you could design your device selection process. Of course you can
also just display the names of the choices and allow the user to select.</p>
<p>Because we're just starting out, Vulkan support is the only thing we need and
therefore we'll settle for just any GPU:</p>
<pre><code class="language-c++ hljs cpp"><span class="hljs-function"><span class="hljs-keyword">bool</span> <span class="hljs-title">isDeviceSuitable</span><span class="hljs-params">(VkPhysicalDevice device)</span> </span>{
    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
}
</code></pre>
<p>In the next section we'll discuss the first real required feature to check for.</p>
<h2 id="page_Queue-families">Queue families</h2>
<p>It has been briefly touched upon before that almost every operation in Vulkan,
anything from drawing to uploading textures, requires commands to be submitted
to a queue. There are different types of queues that originate from different
<em>queue families</em> and each family of queues allows only a subset of commands. For
example, there could be a queue family that only allows processing of compute
commands or one that only allows memory transfer related commands.</p>
<p>We need to check which queue families are supported by the device and which one
of these supports the commands that we want to use. For that purpose we'll add a
new function <code>findQueueFamilies</code> that looks for all the queue families we need.</p>
<p>Right now we are only going to look for a queue that supports graphics commands,
so the function could look like this:</p>
<pre><code class="language-c++ hljs cpp"><span class="hljs-keyword">uint32_t</span> findQueueFamilies(<span class="hljs-type">VkPhysicalDevice</span> device) {
    <span class="hljs-comment">// Logic to find graphics queue family</span>
}
</code></pre>
<p>However, in one of the next chapters we're already going to look for yet another
queue, so it's better to prepare for that and bundle the indices into a struct:</p>
<pre><code class="language-c++ hljs cpp"><span class="hljs-keyword">struct</span> <span class="hljs-type">QueueFamilyIndices</span> {
    <span class="hljs-keyword">uint32_t</span> graphicsFamily;
};

<span class="hljs-function"><span class="hljs-type">QueueFamilyIndices</span> <span class="hljs-title">findQueueFamilies</span><span class="hljs-params">(VkPhysicalDevice device)</span> </span>{
    <span class="hljs-type">QueueFamilyIndices</span> indices;
    <span class="hljs-comment">// Logic to find queue family indices to populate struct with</span>
    <span class="hljs-keyword">return</span> indices;
}
</code></pre>
<p>But what if a queue family is not available? We could throw an exception in
<code>findQueueFamilies</code>, but this function is not really the right place to make
decisions about device suitability. For example, we may <em>prefer</em> devices with a
dedicated transfer queue family, but not require it. Therefore we need some way
of indicating whether a particular queue family was found.</p>
<p>It's not really possible to use a magic value to indicate the nonexistence of a
queue family, since any value of <code>uint32_t</code> could in theory be a valid queue
family index including <code>0</code>. Luckily C++17 introduced a data structure to
distinguish between the case of a value existing or not:</p>
<pre><code class="language-c++ hljs cpp"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;optional&gt;</span></span>

...

<span class="hljs-built_in">std</span>::optional&lt;<span class="hljs-keyword">uint32_t</span>&gt; graphicsFamily;

<span class="hljs-built_in">std</span>::<span class="hljs-built_in">cout</span> &lt;&lt; <span class="hljs-built_in">std</span>::boolalpha &lt;&lt; graphicsFamily.has_value() &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>; <span class="hljs-comment">// false</span>

graphicsFamily = <span class="hljs-number">0</span>;

<span class="hljs-built_in">std</span>::<span class="hljs-built_in">cout</span> &lt;&lt; <span class="hljs-built_in">std</span>::boolalpha &lt;&lt; graphicsFamily.has_value() &lt;&lt; <span class="hljs-built_in">std</span>::<span class="hljs-built_in">endl</span>; <span class="hljs-comment">// true</span>
</code></pre>
<p><code>std::optional</code> is a wrapper that contains no value until you assign something
to it. At any point you can query if it contains a value or not by calling its
<code>has_value()</code> member function. That means that we can change the logic to:</p>
<pre><code class="language-c++ hljs cpp"><span class="hljs-meta">#<span class="hljs-meta-keyword">include</span> <span class="hljs-meta-string">&lt;optional&gt;</span></span>

...

<span class="hljs-keyword">struct</span> <span class="hljs-type">QueueFamilyIndices</span> {
    <span class="hljs-built_in">std</span>::optional&lt;<span class="hljs-keyword">uint32_t</span>&gt; graphicsFamily;
};

<span class="hljs-function"><span class="hljs-type">QueueFamilyIndices</span> <span class="hljs-title">findQueueFamilies</span><span class="hljs-params">(VkPhysicalDevice device)</span> </span>{
    <span class="hljs-type">QueueFamilyIndices</span> indices;
    <span class="hljs-comment">// Assign index to queue families that could be found</span>
    <span class="hljs-keyword">return</span> indices;
}
</code></pre>
<p>We can now begin to actually implement <code>findQueueFamilies</code>:</p>
<pre><code class="language-c++ hljs cpp"><span class="hljs-function"><span class="hljs-type">QueueFamilyIndices</span> <span class="hljs-title">findQueueFamilies</span><span class="hljs-params">(VkPhysicalDevice device)</span> </span>{
    <span class="hljs-type">QueueFamilyIndices</span> indices;

    ...

    <span class="hljs-keyword">return</span> indices;
}
</code></pre>
<p>The process of retrieving the list of queue families is exactly what you expect
and uses <a href="https://www.khronos.org/registry/vulkan/specs/1.0/man/html/vkGetPhysicalDeviceQueueFamilyProperties.html"><code>vkGetPhysicalDeviceQueueFamilyProperties</code></a>:</p>
<pre><code class="language-c++ hljs cpp"><span class="hljs-keyword">uint32_t</span> queueFamilyCount = <span class="hljs-number">0</span>;
<span class="hljs-function">vkGetPhysicalDeviceQueueFamilyProperties</span>(device, &amp;queueFamilyCount, <span class="hljs-literal">nullptr</span>);

<span class="hljs-built_in">std</span>::<span class="hljs-built_in">vector</span>&lt;VkQueueFamilyProperties&gt; queueFamilies(queueFamilyCount);
<span class="hljs-function">vkGetPhysicalDeviceQueueFamilyProperties</span>(device, &amp;queueFamilyCount, queueFamilies.data());
</code></pre>
<p>The <a href="https://www.khronos.org/registry/vulkan/specs/1.0/man/html/VkQueueFamilyProperties.html"><code>VkQueueFamilyProperties</code></a> struct contains some details about the queue family,
including the type of operations that are supported and the number of queues
that can be created based on that family. We need to find at least one queue
family that supports <code>VK_QUEUE_GRAPHICS_BIT</code>.</p>
<pre><code class="language-c++ hljs cpp"><span class="hljs-keyword">int</span> i = <span class="hljs-number">0</span>;
<span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> <span class="hljs-keyword">auto</span>&amp; queueFamily : queueFamilies) {
    <span class="hljs-keyword">if</span> (queueFamily.queueFlags &amp; <span class="hljs-literal">VK_QUEUE_GRAPHICS_BIT</span>) {
        indices.graphicsFamily = i;
    }

    i++;
}
</code></pre>
<p>Now that we have this fancy queue family lookup function, we can use it as a
check in the <code>isDeviceSuitable</code> function to ensure that the device can process
the commands we want to use:</p>
<pre><code class="language-c++ hljs cpp"><span class="hljs-function"><span class="hljs-keyword">bool</span> <span class="hljs-title">isDeviceSuitable</span><span class="hljs-params">(VkPhysicalDevice device)</span> </span>{
    <span class="hljs-type">QueueFamilyIndices</span> indices = findQueueFamilies(device);

    <span class="hljs-keyword">return</span> indices.graphicsFamily.has_value();
}
</code></pre>
<p>To make this a little bit more convenient, we'll also add a generic check to the
struct itself:</p>
<pre><code class="language-c++ hljs cpp"><span class="hljs-keyword">struct</span> <span class="hljs-type">QueueFamilyIndices</span> {
    <span class="hljs-built_in">std</span>::optional&lt;<span class="hljs-keyword">uint32_t</span>&gt; graphicsFamily;

    <span class="hljs-function"><span class="hljs-keyword">bool</span> <span class="hljs-title">isComplete</span><span class="hljs-params">()</span> </span>{
        <span class="hljs-keyword">return</span> graphicsFamily.has_value();
    }
};

...

<span class="hljs-function"><span class="hljs-keyword">bool</span> <span class="hljs-title">isDeviceSuitable</span><span class="hljs-params">(VkPhysicalDevice device)</span> </span>{
    <span class="hljs-type">QueueFamilyIndices</span> indices = findQueueFamilies(device);

    <span class="hljs-keyword">return</span> indices.isComplete();
}
</code></pre>
<p>We can now also use this for an early exit from <code>findQueueFamilies</code>:</p>
<pre><code class="language-c++ hljs cpp"><span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> <span class="hljs-keyword">auto</span>&amp; queueFamily : queueFamilies) {
    ...

    <span class="hljs-keyword">if</span> (indices.isComplete()) {
        <span class="hljs-keyword">break</span>;
    }

    i++;
}
</code></pre>
<p>Great, that's all we need for now to find the right physical device! The next
step is to <a href="https://vulkan-tutorial.com/Drawing_a_triangle/Setup/Logical_device_and_queues">create a logical device</a>
to interface with it.</p>
<p><a href="https://vulkan-tutorial.com/code/03_physical_device_selection.cpp">C++ code</a></p>

        <nav>
        <ul class="pager">
            <li><a href="https://vulkan-tutorial.com/en/Drawing_a_triangle/Setup/Validation_layers">Previous</a></li>            <li><a href="https://vulkan-tutorial.com/en/Drawing_a_triangle/Setup/Logical_device_and_queues">Next</a></li>        </ul>
    </nav>
    
        <div id="waldo-tag-4314"></div>

    <div id="disqus_recommendations" style="margin-bottom: 12px;"><iframe id="dsq-app538" name="dsq-app538" allowtransparency="true" scrolling="no" tabindex="0" title="Disqus" style="width: 100% !important; border: medium none !important; overflow: hidden !important; height: 269px !important; display: inline !important; box-sizing: border-box !important;" src="Physical%20devices%20and%20queue%20families%20-%20Vulkan%20Tutorial_files/a_003.html" horizontalscrolling="no" verticalscrolling="no" width="100%" frameborder="0"></iframe></div><div id="disqus_thread"><iframe id="dsq-app603" name="dsq-app603" allowtransparency="true" scrolling="no" tabindex="0" title="Disqus" style="width: 1px !important; min-width: 100% !important; border: medium none !important; overflow: hidden !important; height: 9198px !important;" src="Physical%20devices%20and%20queue%20families%20-%20Vulkan%20Tutorial_files/a_004.html" horizontalscrolling="no" verticalscrolling="no" width="100%" frameborder="0"></iframe></div>
    <script>
    if (document.location.host) {
        var disqus_config = function() {
            var path = '/Drawing_a_triangle/Setup/Physical_devices_and_queue_families';
            this.page.identifier = path;
        };

        (function() {
            var d = document, s = d.createElement('script');
            s.src = '//vulkan-tutorial.disqus.com/embed.js';
            s.setAttribute('data-timestamp', +new Date());
            (d.head || d.body).appendChild(s);
        })();
    }
    </script>
    <noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript" rel="nofollow">comments powered by Disqus.</a></noscript>
    </article>

                </div>
            </div>
        </div>
    </div>
</div>

    
    <!-- jQuery -->
    <script src="Physical%20devices%20and%20queue%20families%20-%20Vulkan%20Tutorial_files/jquery-1.11.3.min.js"></script>

    <!-- hightlight.js -->
    <script src="Physical%20devices%20and%20queue%20families%20-%20Vulkan%20Tutorial_files/highlight.pack.js"></script>
    <script>hljs.initHighlightingOnLoad();</script>

    <!-- JS -->
    
    <script src="Physical%20devices%20and%20queue%20families%20-%20Vulkan%20Tutorial_files/daux.js"></script>

    


<iframe style="display: none;"></iframe><iframe style="display: none;"></iframe></body></html>